<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Rezervacije</title>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

        // Firebase konfiguracija
        const firebaseConfig = {
            apiKey: "AIzaSyBhclJjGZoBFxOY_Hhr1JtyoJQKatISMAM",
            authDomain: "a-frame-viline-vodice-71975.firebaseapp.com",
            projectId: "a-frame-viline-vodice-71975",
            storageBucket: "a-frame-viline-vodice-71975.firebasestorage.app",
            messagingSenderId: "487511010862",
            appId: "1:487511010862:web:c3c4b9abfa3095f826b9bf",
            measurementId: "G-LLEG9FMNM5"
        };

        // Inicijalizacija Firebase-a
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Funkcija za učitavanje rezervacija
        async function loadReservations() {
            const reservationsRef = collection(db, "reservations");
            const snapshot = await getDocs(reservationsRef);
            const reservationsList = document.getElementById('reservationsList');
            snapshot.forEach(doc => {
                const reservation = doc.data();
                const reservationElement = document.createElement('div');
                reservationElement.innerHTML = `
                    <p>Ime: ${reservation.name}</p>
                    <p>Email: ${reservation.email}</p>
                    <p>Datum: ${reservation.date}</p>
                    <button onclick="approveReservation('${doc.id}')">Odobri</button>
                    <button onclick="rejectReservation('${doc.id}')">Odbij</button>
                `;
                reservationsList.appendChild(reservationElement);
            });
        }

        // Funkcija za odobravanje rezervacije
        async function approveReservation(reservationId) {
            const reservationRef = doc(db, "reservations", reservationId);
            await updateDoc(reservationRef, {
                status: "approved"
            });
            sendEmail(reservationId, "approved");
        }

        // Funkcija za odbijanje rezervacije
        async function rejectReservation(reservationId) {
            const reservationRef = doc(db, "reservations", reservationId);
            await updateDoc(reservationRef, {
                status: "rejected"
            });
            sendEmail(reservationId, "rejected");
        }

        // Funkcija za slanje email-a putem EmailJS
        function sendEmail(reservationId, status) {
            const templateParams = {
                reservationId: reservationId,
                status: status
            };

            emailjs.send('service_dcq3bfr', status === 'approved' ? 'template_5pt9ulh' : 'template_fnzlyi4', templateParams)
                .then(function(response) {
                    console.log('Success', response);
                }, function(error) {
                    console.log('Failed', error);
                });
        }

        // Inicijalizacija EmailJS
        import emailjs from 'https://cdn.emailjs.com/dist/email.min.js';
        emailjs.init('eAYJ4MjHME7vBYIe3');
    </script>
</head>
<body>

    <h1>Admin Panel - Rezervacije</h1>
    
    <!-- Lista rezervacija -->
    <div id="reservationsList">
        <!-- Rezervacije će biti dinamički dodane ovde -->
    </div>

    <script>
        // Učitaj rezervacije kada stranica bude učitana
        window.onload = loadReservations;
    </script>

</body>
</html>
