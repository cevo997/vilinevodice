<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-firestore.js"></script>
    <!-- EmailJS SDK -->
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script>
      // Initialize Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyBhclJjGZoBFxOY_Hhr1JtyoJQKatISMAM",
        authDomain: "a-frame-viline-vodice-71975.firebaseapp.com",
        projectId: "a-frame-viline-vodice-71975",
        storageBucket: "a-frame-viline-vodice-71975.firebasestorage.app",
        messagingSenderId: "487511010862",
        appId: "1:487511010862:web:c3c4b9abfa3095f826b9bf",
        measurementId: "G-LLEG9FMNM5"
      };

      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore(app);

      // EmailJS initialization
      emailjs.init("eAYJ4MjHME7vBYIe3");

      // Load reservations from Firestore
      function loadReservations() {
        const reservationsRef = db.collection("reservations");
        reservationsRef.get().then((querySnapshot) => {
          const reservationList = document.getElementById('reservation-list');
          reservationList.innerHTML = ''; // Clear the list before adding new items
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const reservationElement = document.createElement('li');
            reservationElement.innerHTML = `
              <p><strong>Name:</strong> ${data.name}</p>
              <p><strong>Email:</strong> ${data.email}</p>
              <p><strong>Dates:</strong> ${data.dates}</p>
              <button onclick="approveReservation('${doc.id}', '${data.email}')">Approve</button>
              <button onclick="rejectReservation('${doc.id}', '${data.email}')">Reject</button>
            `;
            reservationList.appendChild(reservationElement);
          });
        }).catch((error) => {
          console.error("Error getting reservations: ", error);
        });
      }

      // Approve reservation
      function approveReservation(reservationId, email) {
        db.collection("reservations").doc(reservationId).update({
          status: "approved"
        }).then(() => {
          sendEmail(email, "approved");
          loadReservations(); // Reload the list after approval
        }).catch((error) => {
          console.error("Error approving reservation: ", error);
        });
      }

      // Reject reservation
      function rejectReservation(reservationId, email) {
        db.collection("reservations").doc(reservationId).update({
          status: "rejected"
        }).then(() => {
          sendEmail(email, "rejected");
          loadReservations(); // Reload the list after rejection
        }).catch((error) => {
          console.error("Error rejecting reservation: ", error);
        });
      }

      // Send email to user via EmailJS
      function sendEmail(email, status) {
        const templateParams = {
          to_email: email,
          status: status
        };
        const templateId = status === "approved" ? "template_5pt9ulh" : "template_fnzlyi4";
        emailjs.send("service_dcq3bfr", templateId, templateParams)
          .then(response => {
            console.log('Email sent successfully', response);
          }, error => {
            console.log('Error sending email', error);
          });
      }

      // Load reservations when the page loads
      window.onload = function() {
        loadReservations();
      }
    </script>
</head>
<body>
    <h1>Admin Panel</h1>
    <h2>Reservations</h2>
    <ul id="reservation-list"></ul>
</body>
</html>
